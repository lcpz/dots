#!/bin/sh
# Based on tabbed-zathura script from:
#   http://taitran.ca/vim/latex/markdown/2015/03/11/vim-latex-and-markdown-preview-scripts.html

xidfile="/tmp/tabbed-zathura.xid"
uri=""

if [ "$#" -gt 0 ]; then
    filename="$1"
fi

runtabbed() {
	tabbed -cdn zathura -r 2 zathura -e '' --fork "$filename" \
        >"$xidfile" 2>/dev/null &
}

if [ ! -r "$xidfile" ]; then
	runtabbed
else
	xid=$(cat "$xidfile")
	xprop -id "$xid" >/dev/null 2>&1
	if [ $? -gt 0 ]; then
		runtabbed
	else
		zathura -e "$xid" --fork "$filename" >/dev/null 2>&1 &
	fi
fi

exit 0
